<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>七夕言情</title>
<meta name="description" content="">
<meta name="keywords" content="">
<link href="" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="style/index.css">
<link rel="stylesheet" type="text/css" href="style/pageA.css">
<link rel="stylesheet" type="text/css" href="style/pageB.css">
<style type="text/css">

</style>
</head>
<body>
	<div id="content">
		<!-- 主题部分 -->
		<ul class="content-wrap">
			<!-- 第一幅页面 -->
			<li>
				<div class="a_background">
					<div class="a_background_top"></div>
					<div class="a_background_middle"></div>
					<div class="a_background_botton"></div>
				</div>
				<!-- 云 -->
				<div class="cloudArea">
					<div class="cloud cloud1"></div>
					<div class="cloud cloud2"></div>
				</div>
				<!-- 太阳 -->
				<div id="sun"></div>
			</li>

			<!-- 第二幅页面 -->
			<li>
				<!-- 背景图 -->
				<div class="b_background"></div>
				<!-- 先让亮灯的图片先加载 防止出现闪屏现象 -->
				<div class="b_background_preload"></div>
				<!-- 商店 -->
				<div class="shop">
					<div class="door">
						<div class="door-left"></div>
						<div class="door-right"></div>
					</div>
					<!-- 灯 -->
					<div class="lamp"></div>
				</div>
			</li>

			<!-- 第三幅页面 -->
			<li>第三页</li>
		</ul>

		<!-- 测试按钮 -->
		<div class="button">
			<button>开始</button>
		</div>
		<div class="button" id="btn2" style="left: 50px;">
			<button>开门</button>
		</div>
		<div class="button" id="btn3" style="left: 100px;">
			<button>关门</button>
		</div>

		<!-- 男孩与根节点并列 -->
		<div id="boy" class="charector slowwalk"></div>
	</div> 




	<script type="text/javascript" src="scripts/jquery.js"></script>

	<!-- 引入jquery.transit插件 -->
	<script type="text/javascript" src="scripts/jquery.transit.js"></script>
	<script type="text/javascript" src="scripts/BoyWalk.js"></script>
	<script type="text/javascript" src="scripts/Swipe.js"></script>
	<script type="text/javascript" src="scripts/Qixi.js"></script>


	<script type="text/javascript">
		/*var swipe = Swipe($("#content"));*/
		$(function(){
			var container = $("#content");
			var swipe = Swipe(container);

			//页面滚到对应的位置
			function scrollTo(time,proportionX){
				var distX = container.width() * proportionX;
				swipe.scrollTo(distX,time);
			}



			var boy = BoyWalk();
			//开始
			$(".button:first").click(function(){
				
				//太阳旋转
				$("#sun").addClass('rotation');

				//云移动
				$(".cloud1").addClass('cloud1Anim');
				$(".cloud2").addClass('cloud2Anim');

				//开始第一次走路
				//页面开始滚动
				boy.walkTo(2000,0.2).then(function(){
					scrollTo(5000,1)
				}).then(function(){
					//第二次走路
					return boy.walkTo(5000,0.5);
				});
			});

			//门的动作
			function doorAction(left,right,time){
				var $door = $(".door");
				var doorLeft = $(".door-left");
				var doorRight = $(".door-right");
				var defer = $.Deferred();
				var count = 2;		//用于计数门开关

				//等待开门关门完成
				var complete = function(){
					if(count == 1){
						defer.resolve();
						return;
					}
					count--;
				};

				doorLeft.transition({
					'left':left
				},time,complete);
				doorRight.transition({
					'left':right
				},time,complete);
			}

			//开门
			function openDoor(){
				return doorAction('-50%','100%',2000);
			}
			//关门
			function closeDoor(){
				return doorAction('0','50%',2000);
			}

			$("#btn2").click(function(){
				openDoor();
			});
			$("#btn3").click(function(){
				closeDoor();
			});


		});

		
	</script>
</body>
</html>