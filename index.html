<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>七夕言情</title>
<meta name="description" content="">
<meta name="keywords" content="">
<link href="" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="style/index.css">
<link rel="stylesheet" type="text/css" href="style/pageA.css">
<link rel="stylesheet" type="text/css" href="style/pageB.css">
<link rel="stylesheet" type="text/css" href="style/pageC.css">
<style type="text/css">

</style>
</head>
<body>
	<div id="content">
		<!-- 主题部分 -->
		<ul class="content-wrap">
			<!-- 第一幅页面 -->
			<li>
				<div class="a_background">
					<div class="a_background_top"></div>
					<div class="a_background_middle"></div>
					<div class="a_background_botton"></div>
				</div>
				<!-- 云 -->
				<div class="cloudArea">
					<div class="cloud cloud1"></div>
					<div class="cloud cloud2"></div>
				</div>
				<!-- 太阳 -->
				<div id="sun"></div>
			</li>

			<!-- 第二幅页面 -->
			<li>
				<!-- 背景图 -->
				<div class="b_background"></div>
				<!-- 先让亮灯的图片先加载 防止出现闪屏现象 -->
				<div class="b_background_preload"></div>
				<!-- 商店 -->
				<div class="shop">
					<div class="door">
						<div class="door-left"></div>
						<div class="door-right"></div>
					</div>
					<!-- 灯 -->
					<div class="lamp"></div>
				</div>
				<!-- 鸟 -->
				<div class="bird"></div>
			</li>

			<!-- 第三幅页面 -->
			<li>
				<!-- 背景图 -->
				<div class="c_background">
					<div class="c_background_top"></div>
					<div class="c_background_middle"></div>
					<div class="c_background_botton"></div>
				</div>
				<!-- 女孩 -->
				<div class="girl"></div>
				<!-- 水波 -->
				<div class="bridge-bottom">
						<div class="water">
						<div id="water1" class="water_1"></div>
						<div id="water2" class="water_2"></div>
						<div id="water3" class="water_3"></div>
						<div id="water4" class="water_4"></div>
					</div>
				</div>
				<!-- 星星 -->
				<ul class="stars">
 					<li class="stars1"></li>
					<li class="stars2"></li>
					<li class="stars3"></li>
					<li class="stars4"></li>
					<li class="stars5"></li>
					<li class="stars6"></li> 
				</ul>
			</li>
		</ul>
		<!-- 飘花 -->
		<div id="snowflake"></div>

		<!-- 测试按钮 -->
		<div class="button">
			<button>开始</button>
		</div>
<!-- 		<div class="button" id="btn2" style="left: 50px;">
	<button>开门</button>
</div>
<div class="button" id="btn3" style="left: 100px;">
	<button>关门</button>
</div> -->

		<!-- 男孩与根节点并列 -->
		<div id="boy" class="charector slowWalk"></div>
	</div> 




	<script type="text/javascript" src="scripts/jquery.js"></script>

	<!-- 引入jquery.transit插件 -->
	<script type="text/javascript" src="scripts/jquery.transit.js"></script>
	<script type="text/javascript" src="scripts/BoyWalk.js"></script>
	<script type="text/javascript" src="scripts/Swipe.js"></script>
	<script type="text/javascript" src="scripts/Qixi.js"></script>


	<script type="text/javascript">
		/*var swipe = Swipe($("#content"));*/
		$(function(){
			var container = $("#content");
			var swipe = Swipe(container);
			var boy = BoyWalk();

			boy.setFlolerWalk();


			var bird = {
				element:$(".bird"),
				fly:function(){
					this.element.addClass('birdFly');
					this.element.transition({
						right:container.width()
					},15000,'linear');
				}
			}
			//页面滚到对应的位置
			function scrollTo(time,proportionX){
				var distX = container.width() * proportionX;
				swipe.scrollTo(distX,time);
			}

			//页面可视区域
			var visualWidth = container.width();
			var visualHeight = container.height();


			//获取数据
			var getValue = function(className){
				var $elem = $('' + className +'');
				//走路的路线坐标
				return{
					height:$elem.height(),
					top:$elem.position().top
				};
			};

			//桥的Y轴
			var bridgeY = function(){
				var data = getValue(".c_background_middle");
				return data.top;
			}();
			/*小女孩*/
			var girl = {
				elem:$(".girl"),
				getHeight:function(){
					return this.elem.height();
				},
				getWidth:function(){
					return this.elem.width();
				},
				getOffset:function(){
					return this.elem.offset();
				},
				setOffset:function(){
					this.elem.css({
						left:visualWidth/2,
						top:bridgeY - this.getHeight()
					});
				},
				rotate:function(){
					this.elem.addClass('girl-rotate');
				}

			};
			//修正女孩的位置
			girl.setOffset();

			/*雪花路径*/
			var snowflakeURL = [
/*				"../img/snowflake/snowflake1.png",
				"../img/snowflake/snowflake2.png",
				"../img/snowflake/snowflake3.png",
				"../img/snowflake/snowflake4.png",
				"../img/snowflake/snowflake5.png",
				"../img/snowflake/snowflake6.png"*/
				'http://img.mukewang.com/55adde120001d34e00410041.png',
		        'http://img.mukewang.com/55adde2a0001a91d00410041.png',
		        'http://img.mukewang.com/55adde5500013b2500400041.png',
		        'http://img.mukewang.com/55adde62000161c100410041.png',
		        'http://img.mukewang.com/55adde7f0001433000410041.png',
		        'http://img.mukewang.com/55addee7000117b500400041.png'
			];

			//飘雪花
			function snowflake(){
				//雪花容器
				var $flakeContainer = $("#snowflake");

				//随机六张图片
				function getImageName(){
					return snowflakeURL[[Math.floor(Math.random() * 6)]]
				}

				//创建一个雪花元素
				function creatSnowBox(){
					var url = getImageName();
				/*	console.log(url);*/
					return $('<div class="snowbox"/></div>').css({
						'width':41,
						'height':41,
						'position':'absolute',
						'backgroundSize':'cover',
						'zIndex':100000,
						'top':'-41px',	
						'backgroundImage':'url('+ url +')'				
					}).addClass('snowRoll');
				}

				//开始飘花
				setInterval(function(){
				//运动的轨迹
				var startPositionLeft = Math.random() * visualWidth -100,
					startOpacity      = 1,
					endPositionTop    = visualHeight - 40,
					endPositionLeft   = startPositionLeft - 100 + Math.random() * 500,
					duration          = visualHeight * 10 + Math.random() * 5000;

				//随机透明度 不小于0.5
				var randomStart = Math.random();
				randomStart = randomStart < 0.5 ? startOpacity : randomStart;

				//创建一个雪花
				var $flake = creatSnowBox();

				//设计起点位置
				$flake.css({
					left:startPositionLeft,
					opacity:randomStart
				});

				//加入到容器中
				$flakeContainer.append($flake);
		/*		console.log($flake);*/

				//开始执行动画
				$flake.transition({
					top:endPositionTop,
					left:endPositionLeft,
					opacity:0.7
				},duration,'ease-out',function(){
					//结束后删除
					$(this).remove();
				});
				}, 200);
			};

			/*零时调整*/
			swipe.scrollTo(container.width()*2, 0);
			console.log(container.width());

			/*function startRun(){
				boy.walkTo(2000,0.5)
					.then(function(){
						//暂停走路
						boy.stopWalk();
					})
					.then(function(){
						//开门
						return openDoor();
					})
					.then(function(){
						//开灯
						lamp.bright();
					})
					.then(function(){
						//进商店
						return boy.toShop(5000);
					})
					.then(function(){
						//取花
						return boy.getFlower();
					})
					.then(function(){
						bird.fly();
					})
					.then(function(){
						//出商店
						return boy.outShop(5000);
					})
					.then(function(){
						//灯暗
						lamp.dark();
					})
					.then(function(){
						//关门
						return closeDoor();
					});
			}*/



		
			//开始
			$(".button:first").click(function(){
				/*
				//太阳旋转
				$("#sun").addClass('rotation');

				//云移动
				$(".cloud1").addClass('cloud1Anim');
				$(".cloud2").addClass('cloud2Anim');

				//开始第一次走路
				//页面开始滚动
				boy.walkTo(2000,0.2).then(function(){
					scrollTo(5000,1)
				}).then(function(){
					//第二次走路
					return boy.walkTo(5000,0.5);
				}).then(startRun);*/


				//第一次走到桥底边
				boy.walkTo(2000,0.2)
					.then(function(){
						//第二次走到桥上
						return boy.walkTo(1500,0.25,(bridgeY - girl.getHeight())/visualHeight)					
					})
					.then(function(){
						//实际走的路程
						var proportionX = (girl.getOffset().left - boy.getWidth() + girl.getWidth()/5)/visualWidth;		
						//第三次走到小女孩面前	
						return boy.walkTo(1500,proportionX);			
					})
					.then(function(){
						//图片还原原地停止状态
						boy.resetOriginal();
					})
					.then(function(){
						//增加男孩女孩转身动作
						setTimeout(function(){
							girl.rotate();
							boy.rotate(function(){
								console.log('转身完成');

							});
						}, 1000);
					})
					.then(function(){
							snowflake();	
					})


			});

			


			

/*
			$("#btn2").click(function(){
				openDoor().then(function(){
					lamp.bright();
				});
			});
			$("#btn3").click(function(){
				closeDoor().then(function(){
					lamp.dark();
				});
			});*/

		});

		
	</script>
</body>
</html>